{% extends 'base.html.twig' %}

{% block panel %}
  <ul class="nav nav-pills nav-stacked">
    <li class="active">
      <a href="/">Home</a>
    </li>
  </ul>
{% endblock %}

{% block side_content %}

{% endblock %}

{% block body %}
  <div class="row">
    {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %} <!-- condition si authentifié -->
      <div class="col-md-12">
        <h1>Dashboard</h1>
        <div class="panel panel-default">
          <div class="panel-heading"><b>Utilisateurs signalés</b></div>
          <div class="panel-body">
            <ul>
              {% for user in users %}
              <li>
                <a href="#">{{ user }}</a>
                <button class="flt-r" id="users{{ user.id }}">Bloquer</button>
                <script type="text/javascript">
                  $("#users"+{{ user.id }}).click(function(){
                    moderate("users", {{ user.id }});
                  }
                  );
                </script>
              </li>
              <hr>
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><b>Series à moderer</b></div>
          <div class="panel-body">
            <ul>
              {% for serie in series %}
              <li>
                <a href="#">{{ serie.title }}</a>
                <button class="flt-r" id="series{{ serie.id }}">Valider</button>
                <script type="text/javascript">
                  $("#series"+{{ serie.id }}).click(function(){
                    moderate("series", {{ serie.id }});
                  }
                  );
                </script>
              </li>
              <hr>
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><b>Episodes à moderer</b></div>
          <div class="panel-body">
            <ul>
            {% for episode in episodes %}
              <li>
                <a href="#">{{ episode.title }}</a>
                <button class="flt-r" id="episodes{{ episode.id }}">Valider</button>
                <script type="text/javascript">
                  $("#episodes"+{{ episode.id }}).click(function(){
                    moderate("episodes", {{ episode.id }});
                  }
                  );
                </script>
              </li>
              <hr>
            {% endfor %}
            <ul>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><b>Commentaires signalés</b></div>
          <div class="panel-body">
            <ul>
            {% for comment in comments %}
              <li>
                <a href="#">{{ comment.author }}</a>
                <button class="flt-r" id="comments{{ comment.id }}">Bloquer</button>
                <script type="text/javascript">
                  $("#comments"+{{ comment.id }}).click(function(){
                    moderate("comments", {{ comment.id }});
                  }
                  );
                </script>
              </li>
              <hr>
            {% endfor %}
          </ul>
        </div>
      </div>
      {% else %} <!-- todo : outil de tradiction à mettre en place -->
        Vous devez être moderateur pour acceder à cette page.</h3>
        <a href="/" class="btn btn-primary">retour</a>
    {% endif %}
  </div>
  <script type="text/javascript">
      /**
      * Ajax request
      *
      * @data : path, button, id
      */
      function moderate(path, id)
      {
        var url = "/dashboard/"+path;
        $.ajax(
          {
            url: url,
            type: 'GET',
            data: { id: id },
            success: function(data){
              if (data) {
                $("#"+path+id).html(data);
              }
            },
            error: function(error){
              console.log(error);
            }
          }
        );
      }
  </script>
{% endblock %}
